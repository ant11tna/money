<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>基金动态预估</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="page">
    <div id="toastArea" class="toast-area"></div>

    <header class="header">
      <div class="header-title">
        <h1>FUND TERMINAL · 基金持仓动态预估</h1>
        <div class="subtle">深色终端视图 · 高密度行情与估值</div>
      </div>
      <div class="header-actions">
        <div id="providerStatus" class="status-pill">DATA: AUTO</div>
        <button id="themeToggleBtn" onclick="toggleTheme()">切换浅色</button>
      </div>
    </header>

    <section class="kpi-row">
      <article class="kpi-card">
        <div class="kpi-label">今日预估收益</div>
        <div id="kpiEstimatePnl" class="kpi-value">—</div>
      </article>
      <article class="kpi-card">
        <div class="kpi-label">预估总资产</div>
        <div id="kpiAssets" class="kpi-value">—</div>
      </article>
      <article class="kpi-card">
        <div class="kpi-label">持仓数量</div>
        <div id="kpiPositions" class="kpi-value">0</div>
      </article>
      <article class="kpi-card">
        <div class="kpi-label">数据刷新时间</div>
        <div id="kpiRefresh" class="kpi-value">—</div>
      </article>
    </section>

    <main class="grid-main">
      <div class="stack">
        <section class="card">
          <div class="card-header">
            <div class="tabs" id="marketTabs">
              <button class="tab-btn active" data-market="cn" onclick="switchMarket('cn')">A股</button>
              <button class="tab-btn" data-market="hk" onclick="switchMarket('hk')">港股</button>
              <button class="tab-btn" data-market="us" onclick="switchMarket('us')">美股</button>
            </div>
            <div class="actions">
              <button id="refreshBtn" onclick="refreshMarketAndGold()">刷新指数与黄金</button>
              <label class="auto-refresh-toggle">
                <input id="autoRefreshToggle" type="checkbox" onchange="toggleAutoRefresh(this.checked)" />
                自动刷新(10s)
              </label>
            </div>
          </div>
          <div class="card-body">
            <div class="ticker-row ticker-head">
              <div>名称</div><div class="t-right">点位</div><div class="t-right">涨跌幅</div><div class="t-right">涨跌点</div>
            </div>
            <div id="indexCards"></div>
          </div>
        </section>

        <section class="card">
          <div class="card-header"><b>黄金估值报价板</b></div>
          <div class="card-body">
            <div class="table-wrap">
              <table>
              <thead><tr><th class="t-left">平台</th><th class="t-right">价格</th><th class="t-right">涨跌</th><th class="t-right">涨跌幅</th></tr></thead>
              <tbody id="goldCards"></tbody>
            </table>
            </div>
          </div>
        </section>
      </div>

      <div class="stack">
        <section class="card">
          <div class="card-header"><b>我的持仓（可编辑）</b></div>
          <div class="card-body">
            <div class="muted">基金代码（空格/逗号分隔）</div>
            <textarea id="codes"></textarea>
            <div class="actions" style="margin-top:8px;">
              <button onclick="syncPortfolio()">同步基金列表到持仓表</button>
              <button onclick="savePortfolio()">保存持仓</button>
              <button id="estimateBtn" onclick="runEstimate()">抓取最新持仓并预估</button>
            </div>
            <p class="muted">优先用 akshare 抓持仓（若环境已安装），否则回退 Eastmoney；成本价是纯数值，不带 %。</p>
            <div class="table-wrap">
              <table id="portfolio">
              <thead><tr><th class="t-left">基金代码</th><th class="t-right">持有份额</th><th class="t-right">成本价</th><th class="t-right">当前持有收益(元,可编辑)</th></tr></thead>
              <tbody></tbody>
            </table>
            </div>
            <div id="msg" class="muted"></div>
          </div>
        </section>

        <section class="card">
          <div class="card-header"><b>基金估值结果</b></div>
          <div class="card-body">
            <div id="summary"></div>
            <div id="details"></div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <div id="detailModalMask" class="modal-mask" onclick="closeFundDetail(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-head">
        <div>
          <h3 id="detailTitle" style="margin:0;">基金详情</h3>
          <p id="detailMeta" class="muted" style="margin:6px 0 0;">-</p>
        </div>
        <button class="close-btn" onclick="closeFundDetail()">关闭</button>
      </div>
      <div class="modal-body">
        <div class="tabs">
          <button class="tab-btn active" data-detail-tab="history" onclick="switchDetailTab('history')">历史业绩</button>
          <button class="tab-btn" data-detail-tab="stage" onclick="switchDetailTab('stage')">阶段涨幅</button>
          <button class="tab-btn" data-detail-tab="nav" onclick="switchDetailTab('nav')">历史净值</button>
          <button class="tab-btn" data-detail-tab="holding" onclick="switchDetailTab('holding')">持仓详情</button>
        </div>
        <div id="tab-history" class="tab-content active"></div>
        <div id="tab-stage" class="tab-content"></div>
        <div id="tab-nav" class="tab-content">
          <canvas id="navCanvas" width="940" height="260"></canvas>
          <div id="navLegend" class="muted"></div>
        </div>
        <div id="tab-holding" class="tab-content"></div>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
</body>
</html>
